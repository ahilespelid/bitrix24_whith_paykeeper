
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js?17289995485071";s:6:"source";s:77:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.js";s:3:"min";s:81:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.map.js";}"*/
(function(){BX.namespace("BX.UI.SidePanel");if(BX.UI.SidePanel.Wrapper){return}function t(t){}t.prototype.init=function(t){this.container=BX(t.containerId);this.isCloseAfterSave=t.isCloseAfterSave||false;this.isReloadGridAfterSave=t.isReloadGridAfterSave||false;this.isReloadPageAfterSave=t.isReloadPageAfterSave||false;this.skipNotification=t.skipNotification||false;this.useLinkTargetsReplacing=t.useLinkTargetsReplacing||false;this.notification=t.notification||{};var e=BX.SidePanel.Instance.getPreviousSlider(BX.SidePanel.Instance.getSliderByWindow(window));this.parentWindow=e?e.getWindow():top;this.initEditableTitle(t);if(this.isReloadGridAfterSave){if(this.getParam("reloadGridAfterSave")){this.reloadGridOnParentPage()}this.setParam("reloadGridAfterSave",true)}if(this.isCloseAfterSave){if(this.getParam("closeAfterSave")){var i;if(this.notification.content&&top.BX&&!this.getParam("skipNotification")){i=function(){top.BX.loadExt("ui.notification").then(function(){top.BX.UI.Notification.Center.notify(this.notification)}.bind(this))}.bind(this)}else if(this.isReloadPageAfterSave){i=function(){this.parentWindow.location.reload()}.bind(this)}BX.SidePanel.Instance.close(false,i)}if(this.skipNotification){this.setParam("skipNotification",true)}this.setParam("closeAfterSave",true)}if(this.useLinkTargetsReplacing){this.initLinkTargetsReplacing()}};t.prototype.initEditableTitle=function(t){if(!t.title||!t.title.selector||!t.title.defaultTitle){return}var i=this.container.querySelector(t.title.selector);if(!i){return}var n=i.querySelector('input[type="text"]');if(!n){return}i.style.display="none";e.init({dataContainer:i,dataNode:n,defaultTitle:t.title.defaultTitle})};t.prototype.initLinkTargetsReplacing=function(){this.replaceLinkTargets();if(!window.MutationObserver){return}var t=new MutationObserver(this.domMutationHandler.bind(this));t.observe(this.container,{childList:true,subtree:true})};t.prototype.domMutationHandler=function(t){t.forEach(function(t){for(var e=0;e<t.addedNodes.length;++e){var i=t.addedNodes.item(e);if(!i){continue}this.replaceLinkTargets(i)}},this)};t.prototype.replaceLinkTargets=function(t){if(!t){t=document.body}var e=[];if(t.tagName==="A"){e=[t]}else if(t.nodeName!=="#text"){e=BX.convert.nodeListToArray(t.querySelectorAll("a"))}if(e.length===0){return}BX.convert.nodeListToArray(e).filter(function(t){return!t.target}).forEach(function(t){t.target="_top"})};t.prototype.setParam=function(t,e){var i=BX.SidePanel.Instance.getSliderByWindow(window);if(i){i.getData().set(t,e)}};t.prototype.getParam=function(t){var e=BX.SidePanel.Instance.getSliderByWindow(window);if(e){return e.getData().get(t)}return undefined};t.prototype.removeParam=function(t){var e=BX.SidePanel.Instance.getSliderByWindow(window);if(e){e.getData().delete(t)}};t.prototype.reloadGridOnParentPage=function(){var t=this.parentWindow;var e=BX.type.isString(this.isReloadGridAfterSave)?this.isReloadGridAfterSave:null;if(!t.BX.Main||!t.BX.Main.gridManager){return}if(e==="all"){t.BX.Main.gridManager.data.forEach(function(t){t.instance.reload()});return}if(!e&&t.BX.Main.gridManager.data){var i=t.BX.Main.gridManager.data;e=i.length>0?i[0].id:null}if(!e){return}var n=t.BX.Main.gridManager.getById(e);if(!n){return}n.instance.reload()};var e={isInit:false,init:function(t){this.dataNode=t.dataNode;this.titleNode=document.querySelector(".ui-side-panel-wrap-title-name");this.inputNode=document.querySelector(".ui-side-panel-wrap-title-input");this.buttonNode=document.querySelector(".ui-side-panel-wrap-title-edit-button");this.initialTitle=this.titleNode.textContent;this.defaultTitle=t.defaultTitle;BX.bind(this.dataNode,"bxchange",this.onDataNodeChange.bind(this));BX.bind(this.buttonNode,"click",this.startEdit.bind(this));BX.bind(this.inputNode,"keyup",this.onKeyUp.bind(this));BX.bind(this.inputNode,"blur",this.endEdit.bind(this));this.isInit=true;if(!t.disabled){this.enable()}if(!this.dataNode.value){this.dataNode.value=this.defaultTitle}},enable:function(t){t=t||false;if(!this.isInit){return}this.changeDisplay(this.buttonNode,!t);this.titleNode.textContent=!t?this.dataNode.value?this.dataNode.value:this.defaultTitle:this.initialTitle},disable:function(){this.enable(true)},onDataNodeChange:function(){this.titleNode.textContent=this.dataNode.value},onKeyUp:function(t){t=t||window.event;if(t.keyCode===10||t.keyCode===13){this.endEdit();t.preventDefault();return false}},getTitle:function(){var t=this.dataNode.value;if(!t){t=this.titleNode.textContent}return t},startEdit:function(){this.inputNode.value=this.getTitle();this.changeDisplay(this.titleNode,false);this.changeDisplay(this.buttonNode,false);this.changeDisplay(this.inputNode,true);this.inputNode.focus()},endEdit:function(){this.dataNode.value=this.inputNode.value;this.titleNode.textContent=this.inputNode.value;this.changeDisplay(this.inputNode,false);this.changeDisplay(this.buttonNode,true);this.changeDisplay(this.titleNode,true)},changeDisplay:function(t,e){return t.style.display=e?"":"none"}};BX.UI.SidePanel.Wrapper=new t})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/catalog.image.input/templates/.default/script.min.js?17289999854797";s:6:"source";s:74:"/bitrix/components/bitrix/catalog.image.input/templates/.default/script.js";s:3:"min";s:78:"/bitrix/components/bitrix/catalog.image.input/templates/.default/script.min.js";s:3:"map";s:78:"/bitrix/components/bitrix/catalog.image.input/templates/.default/script.map.js";}"*/
(function(e,t,i){"use strict";function a(e,t){n(e,t);t.add(e)}function n(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function s(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var l=new WeakSet;var r=function(){babelHelpers.createClass(e,null,[{key:"getById",value:function t(i){return e.imageInputInstances.get(i)||null}}]);function e(n){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,e);a(this,l);babelHelpers.defineProperty(this,"onUploaderIsInitedHandler",this.handleOnUploaderIsInited.bind(this));babelHelpers.defineProperty(this,"values",new Map);babelHelpers.defineProperty(this,"newValues",new Map);this.id=n;this.wrapper=BX(n);if(!this.wrapper){return}this.productId=s.productId;this.skuId=s.skuId;this.iblockId=s.iblockId;this.saveable=s.saveable;this.inputId=s.inputId;this.ajaxStatus=e.WAIT_STATUS;if(s.hideAddButton===true){var r=this.wrapper.querySelector('[data-role="image-add-button"]');if(t.Type.isDomNode(r)){r.style.display="none"}}if(t.Type.isObject(s.values)){for(var u in s.values){if(!s.values.hasOwnProperty(u)){continue}this.values.set(u,s.values[u])}}if(this.isSaveable()){i.EventEmitter.subscribe("onUploaderIsInited",this.onUploaderIsInitedHandler)}e.imageInputInstances.set(this.id,this)}babelHelpers.createClass(e,[{key:"isSaveable",value:function e(){return this.saveable===true}},{key:"handleOnUploaderIsInited",value:function e(a){var n=a.getCompatData(),s=babelHelpers.slicedToArray(n,2),l=s[0],r=s[1];if(t.Type.isStringFilled(this.inputId)&&this.inputId===l){this.uploaderFieldMap=new Map;i.EventEmitter.subscribe(r,"onFileIsDeleted",this.onFileDelete.bind(this));i.EventEmitter.subscribe(r,"onFileIsUploaded",this.onFileUpload.bind(this));i.EventEmitter.subscribe(r,"onDone",this.onDone.bind(this));i.EventEmitter.subscribe(r,"onQueueIsChanged",this.onQueueIsChanged.bind(this))}}},{key:"unsubscribeEvents",value:function e(){if(this.isSaveable()){i.EventEmitter.unsubscribe("onUploaderIsInited",this.onUploaderIsInitedHandler)}}},{key:"unsubscribeImageInputEvents",value:function e(){if(t.Reflection.getClass("BX.UI.ImageInput")){var i=BX.UI.ImageInput.getById(this.inputId);if(i){i.unsubscribeEvents()}}}},{key:"getId",value:function e(){return this.id}},{key:"setId",value:function e(t){this.id=t}},{key:"onFileDelete",value:function e(i){var a=i.getCompatData(),n=babelHelpers.slicedToArray(a,4),s=n[3];var l=s.input_name;if(t.Type.isNil(l)){return null}this.values["delete"](l);if(this.isSaveable()){this.save()}}},{key:"onQueueIsChanged",value:function e(i){var a=i.getCompatData(),n=babelHelpers.slicedToArray(a,4),s=n[1],l=n[2],r=n[3];var u=r.file;if(s==="add"&&"input_name"in u&&t.Type.isNil(this.uploaderFieldMap.get(l))){this.uploaderFieldMap.set(l,u["input_name"])}}},{key:"onDone",value:function e(){if(this.newValues.size>0&&this.isSaveable()){this.save()}this.newValues.clear()}},{key:"onFileUpload",value:function e(i){var a=i.getCompatData(),n=babelHelpers.slicedToArray(a,3),r=n[0],o=n[2];if(!this.isSaveable()||!t.Type.isObject(o)||!("file"in o)||!("files"in o.file)||!("default"in o.file.files)){return}s(this,l,u).call(this,{tool:"catalog",category:"product_selector",event:"image_upload"});var d=o["file"]["files"]["default"];var p={fileId:r,data:{name:d.name,type:d.type,tmp_name:d.path,size:d.size,error:null}};var c=this.uploaderFieldMap.get(r)||r;this.values.set(c,p);this.newValues.set(c,p)}},{key:"save",value:function e(){var a=this;if(this.submitFileTimeOut){clearTimeout(this.submitFileTimeOut)}var n=t.Text.getRandom(20);this.refreshImageSelectorId=n;this.submitFileTimeOut=setTimeout((function(){var e={};a.values.forEach((function(t,i){e[i]=t}));t.ajax.runAction("catalog.productSelector.saveMorePhoto",{json:{productId:a.productId,variationId:a.skuId,iblockId:a.iblockId,imageValues:e}}).then((function(e){var s;if(!a.refreshImageSelectorId===n){return}a.values.clear();if(t.Type.isObject((s=e.data)===null||s===void 0?void 0:s.values)){for(var l in e.data.values){if(!e.data.values.hasOwnProperty(l)){continue}a.values.set(l,e.data.values[l])}}t.Runtime.html(a.wrapper,e.data.input);i.EventEmitter.emit("Catalog.ImageInput::save",[a.id,a.inputId,e])}))}),500)}}]);return e}();function u(e){t.Runtime.loadExtension("ui.analytics").then((function(t){var i=t.sendData;i(e)}))["catch"]((function(){console.error("catalog.image.input: can't load ui.analytics")}))}babelHelpers.defineProperty(r,"imageInputInstances",new Map);babelHelpers.defineProperty(r,"PROCESS_STATUS","PROCESS");babelHelpers.defineProperty(r,"WAIT_STATUS","WAIT");t.Reflection.namespace("BX.Catalog").ImageInput=r})(this.window=this.window||{},BX,BX.Event);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:88:"/bitrix/components/bitrix/ui.image.input/templates/.default/script.min.js?17289995487083";s:6:"source";s:69:"/bitrix/components/bitrix/ui.image.input/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/ui.image.input/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/ui.image.input/templates/.default/script.map.js";}"*/
(function(e,t,i,a){"use strict";var n;var r=new Map;var s=function(){babelHelpers.createClass(e,null,[{key:"getById",value:function e(t){return r.get(t)||null}}]);function e(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"container",null);babelHelpers.defineProperty(this,"loaderContainer",null);babelHelpers.defineProperty(this,"addButton",null);babelHelpers.defineProperty(this,"loader",null);babelHelpers.defineProperty(this,"timeout",null);babelHelpers.defineProperty(this,"uploading",false);babelHelpers.defineProperty(this,"onUploaderIsInitedHandler",this.handleOnUploaderIsInited.bind(this));babelHelpers.defineProperty(this,"recalculateWrapperHandler",this.recalculateWrapper.bind(this));this.instanceId=a.instanceId;this.containerId=a.containerId;this.loaderContainerId=a.loaderContainerId;this.settings=a.settings||{};this.disabled=a.disabled||false;if(this.disabled){t.Event.bind(this.getContainer(),"click",(function(e){e.stopPropagation();e.preventDefault()}))}this.addImageHandler=this.addImage.bind(this);this.editImageHandler=this.editImage.bind(this);i.EventEmitter.subscribe("onUploaderIsInited",this.onUploaderIsInitedHandler);r.set(this.instanceId,this)}babelHelpers.createClass(e,[{key:"handleOnUploaderIsInited",value:function e(a){var n=this;var r=a.getCompatData(),s=babelHelpers.slicedToArray(r,2),l=s[0],o=s[1];if(this.instanceId===l){if(this.getPreviews().length>0){t.Dom.addClass(this.getFileWrapper(),"ui-image-input-wrapper")}requestAnimationFrame((function(){n.getLoaderContainer()&&(n.getLoaderContainer().style.display="none");n.getContainer().style.display=""}));i.EventEmitter.subscribe(o,"onFileIsDeleted",this.onFileIsDeletedHandler.bind(this));i.EventEmitter.subscribe(o,"onStart",this.onUploadStartHandler.bind(this));i.EventEmitter.subscribe(o,"onDone",this.onUploadDoneHandler.bind(this));i.EventEmitter.subscribe(o,"onFileCanvasIsLoaded",this.onFileCanvasIsLoadedHandler.bind(this));i.EventEmitter.unsubscribe("onDemandRecalculateWrapper",this.recalculateWrapperHandler);i.EventEmitter.subscribe("onDemandRecalculateWrapper",this.recalculateWrapperHandler)}}},{key:"unsubscribeEvents",value:function e(){i.EventEmitter.unsubscribe("onDemandRecalculateWrapper",this.recalculateWrapperHandler);i.EventEmitter.unsubscribe("onUploaderIsInited",this.onUploaderIsInitedHandler)}},{key:"getInputInstance",value:function e(){return BX.UI.FileInput.getInstance(this.instanceId)}},{key:"getFileInput",value:function e(){return this.getInputInstance().agent.fileInput}},{key:"getContainer",value:function e(){if(!this.container){this.container=document.getElementById(this.containerId);if(!t.Type.isDomNode(this.container)){throw Error("Can't find container with id ".concat(this.containerId))}}return this.container}},{key:"getFileWrapper",value:function e(){if(!this.fileWrapper){this.fileWrapper=this.getContainer().querySelector(".adm-fileinput-wrapper")}return this.fileWrapper}},{key:"getLoaderContainer",value:function e(){if(!this.loaderContainer){this.loaderContainer=document.getElementById(this.loaderContainerId)}return this.loaderContainer}},{key:"getAddButton",value:function e(){if(!this.addButton){this.addButton=this.getContainer().querySelector('[data-role="image-add-button"]')}return this.addButton}},{key:"editImage",value:function e(t){if(t.target===this.getFileInput()){if(t.detail===0){return}else{t.preventDefault()}}var i=this.getInputInstance();var a=i.agent.getItems().items;for(var n in a){if(a.hasOwnProperty(n)){i.frameFlags.active=true;i.frameFiles(n);break}}}},{key:"addImage",value:function e(t){t.preventDefault();t.stopPropagation();this.getFileInput().click()}},{key:"getLoader",value:function e(){if(!this.loader){this.loader=new a.Loader({target:this.getFileWrapper().querySelector(".adm-fileinput-drag-area")})}return this.loader}},{key:"showLoader",value:function e(){this.getLoader().setOptions({size:Math.min(this.getContainer().offsetHeight,this.getContainer().offsetWidth)});this.getLoader().show()}},{key:"hideLoader",value:function e(){this.getLoader().hide()}},{key:"onFileIsDeletedHandler",value:function e(){var t=this;this.timeout=clearTimeout(this.timeout);this.timeout=setTimeout((function(){t.hideLoader();t.recalculateWrapper()}),100)}},{key:"onUploadStartHandler",value:function e(t){var i=this;var a=t.getCompatData(),n=babelHelpers.slicedToArray(a,1),r=n[0];if(r){this.uploading=true}clearTimeout(this.timeout);this.timeout=setTimeout((function(){i.showLoader();i.recalculateWrapper()}),100)}},{key:"onUploadDoneHandler",value:function e(t){var i=this;var a=t.getCompatData(),n=babelHelpers.slicedToArray(a,1),r=n[0];if(r){this.uploading=false;this.timeout=clearTimeout(this.timeout);requestAnimationFrame((function(){i.hideLoader();i.recalculateWrapper()}))}}},{key:"onFileCanvasIsLoadedHandler",value:function e(){var t=this;if(this.timeout&&!this.uploading){this.uploading=false;this.timeout=clearTimeout(this.timeout);requestAnimationFrame((function(){t.hideLoader();t.recalculateWrapper()}))}}},{key:"isMultipleInput",value:function e(){return this.getInputInstance().uploadParams.maxCount!==1}},{key:"buildShadowElement",value:function e(i){if(i.offsetParent===null){return}var a=i.querySelector("div.ui-image-item-shadow");if(!a){a=t.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['<div class="ui-image-item-shadow"></div>'])));t.Dom.prepend(a,i)}var r=i.querySelector("canvas");if(r){var s=4;a.style.height=r.offsetHeight+"px";a.style.width=r.offsetWidth-s+"px";i.querySelector(".adm-fileinput-item-preview").style.height=r.offsetHeight+"px";i.closest(".adm-fileinput-item-wrapper").style.height=r.offsetHeight+"px"}}},{key:"getPreviews",value:function e(){return this.getFileWrapper().querySelectorAll(".adm-fileinput-item")}},{key:"recalculateWrapper",value:function e(){var i=this.getFileWrapper();var a=this.getPreviews();var n=Math.min(a.length,3);if(n){this.buildShadowElement(a[0]);t.Dom.addClass(i,"ui-image-input-wrapper");this.getFileInput().style.display="none";t.Event.unbind(i,"click",this.editImageHandler);t.Event.bind(i,"click",this.editImageHandler);if(this.isMultipleInput()){this.getAddButton().style.display="";t.Event.unbindAll(this.getAddButton());t.Event.bind(this.getAddButton(),"click",this.addImageHandler)}}else{t.Dom.removeClass(i,"ui-image-input-wrapper");this.getFileInput().style.display="";t.Event.unbind(i,"click",this.editImageHandler);if(this.isMultipleInput()){this.getAddButton().style.display="none";t.Event.unbindAll(this.getAddButton())}}switch(n){case 3:t.Dom.addClass(i,"ui-image-input-wrapper-multiple");t.Dom.removeClass(i,"ui-image-input-wrapper-double");break;case 2:t.Dom.addClass(i,"ui-image-input-wrapper-double");t.Dom.removeClass(i,"ui-image-input-wrapper-multiple");break;default:t.Dom.removeClass(i,"ui-image-input-wrapper-double");t.Dom.removeClass(i,"ui-image-input-wrapper-multiple");break}}}]);return e}();t.Reflection.namespace("BX.UI").ImageInput=s})(this.window=this.window||{},BX,BX.Event,BX);
/* End */
;; /* /bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js?17289995485071*/
; /* /bitrix/components/bitrix/catalog.image.input/templates/.default/script.min.js?17289999854797*/
; /* /bitrix/components/bitrix/ui.image.input/templates/.default/script.min.js?17289995487083*/

//# sourceMappingURL=page_9b814f965b2ba37b76b35361e5c8db16.map.js